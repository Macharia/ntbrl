<?php (defined('BASEPATH')) OR exit('No direct script access allowed');

/* The MX_Controller class is autoloaded as required */

class  MY_Controller  extends  MX_Controller {

	function __construct() {
		parent::__construct();
		date_default_timezone_set('Africa/Nairobi');
	}
	
	
	public function is_logged_in()
	{
		
		$this->_ci->load->library('session');
		$this->_ci->load->model('login');
		$username = $this->_ci->session->userdata(config_item('username'));
		$password = $this->_ci->session->userdata(config_item('password'));
		return $this->_ci->auth_model->password_check($username, $password, TRUE);
		
		
		
		
		
	}

	
	public function session_check(){

		//code to check session
		// if(session = ""){
			

		// 	redirect('login','location');

		
		// }
		

	}


    public function GetMaxMonthbasedonMaxYear()
{
	
	$query_str = "SELECT month(max(End_Time)) AS maxmonth FROM sample1 ";

	$result = $this->db->query($query_str)->result_array();
	// echo "<pre>";
	// print_r($result);die();
	$getmaxyear = $result;

	
	//$year = $maxyear;
	$showyear = $getmaxyear[0]['maxmonth'];


 	//$result = $this->db->query($query_str)->result_array();

	if ($showyear !='')
	{
	}
	else
	{
	$showyear=date('m');
	}
return $showyear;
}
	
	function GetMonthName($month)
{
	$monthname="";
 if ($month==1)
 {
     $monthname=" Jan ";
 }
else if ($month==2)
 {
     $monthname=" Feb ";
 }else if ($month==3)
 {
     $monthname=" Mar ";
 }else if ($month==4)
 {
     $monthname=" Apr ";
 }else if ($month==5)
 {
     $monthname=" May ";
 }else if ($month==6)
 {
     $monthname=" Jun ";
 }else if ($month==7)
 {
     $monthname=" Jul ";
 }else if ($month==8)
 {
     $monthname=" Aug ";
 }else if ($month==9)
 {
     $monthname=" Sep ";
 }else if ($month==10)
 {
     $monthname=" Oct ";
 }else if ($month==11)
 {
     $monthname=" Nov ";
 }
  else if ($month==12)
 {
     $monthname=" Dec ";
 }
  else if ($month==13)
 {
     $monthname=" Jan - Sep  ";
 }
return $monthname;
}
	



public function GetMaxYear(){
    $query_str = "SELECT max(year(End_Time)) AS maximumyear 
                  FROM sample1";
    $result = $this->db->query($query_str)->result_array();
    if($result){
    	$maximumyear = $result[0]['maximumyear'];
    }else{
    	$showyear=date('Y');
    }
   return $maximumyear;
}


public function GetMinYear()
{
	

    $query_str = "SELECT MIN(year(End_Time)) AS minimumyear FROM sample1 ";
    $result = $this->db->query($query_str)->result_array();

    if($result){
    	$minimumyear = $result[0]['minimumyear'];
    }else{
    	$showyear=date('Y');
    }
   return $minimumyear;
}

	


public function get_countyname($countyid)
		{


			$countyID = $countyid;

			$query_str=" SELECT name 
								AS cN 
								FROM countys 
								WHERE ID ='$countyID' "
											;


						

			$result = $this->db->query($query_str)->result_array();
			
			foreach ($result as $key => $value) {
				 $countyname=$value['cN'];
			}
			
			 return $countyname;







}







public function get_rs()
{

	$query_str="SELECT County,total
						FROM(
						SELECT 
								countys.name AS County,
								count(*) as total
						FROM sample
						LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
						LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
						LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
						LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
						WHERE `countys`.`ID` ='$countyID'
						Group by County
						)x";

			$result = $this->db->query($query_str)->result_array();

			$rs = $result;





}

public function get_r()
{

	$query_str="SELECT 
						`section3`.`facility` AS a,
						`facilitys`.`name` AS b, 
						`districts`.`name` AS c,
						section3.make AS d,
						`countys`.`name` as e
					FROM `section3` ,facilitys, `districts` ,`countys`
					WHERE 
								`section3`.`facility`= `facilitys`.`facilitycode`
							AND  `districts`.`ID` = `facilitys`.`district`
							AND `countys`.`ID` = `districts`.`county`
							AND `countys`.`ID` ='$countyID'";

			$result = $this->db->query($query_str)->result_array();

			$r = $result;





}


 public function totalTestsCountyWise($countyID,$filter,$currentmonth,$currentyear,$fromfilter,$tofilter,$fromdate,$todate)
	  {
	  if ($filter==0) //last submission
	  {
	  $query_str="SELECT count(*) as total,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR  Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR  Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' THEN 1 ELSE 0 END ) AS mtb,
sum(CASE WHEN Test_Result = 'MTB NOT DETECTED'  THEN 1 ELSE 0 END) as neg,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' THEN 1 ELSE 0 END ) AS rif, 
 sum(CASE WHEN (age<5) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END) as totalbelow,

sum( CASE WHEN ( age<5 ) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbbelow,
sum( CASE WHEN  (age<5) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifbelow,
sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END) as totalbtwn,
sum( CASE WHEN  (age Between 6 AND 15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbbtwn,
sum( CASE WHEN (age Between 6 AND 15) AND   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifbtwn,
sum(CASE WHEN (age>15) THEN 1 ELSE 0 END) as totalabove,
sum( CASE WHEN (age>15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =    'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbabove,
sum( CASE WHEN  (age>15) AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifabove,
sum(CASE WHEN (gender='Male') THEN 1 ELSE 0 END) as totalMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED' ) THEN 1 ELSE 0 END ) AS mtbMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifMale,
sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END) as totalFemale,
sum( CASE WHEN (gender='Female') AND   (Test_Result =    'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFemale,
sum( CASE WHEN (gender='Female') AND    (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifFemale,
sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) as totalNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNotsp,  
sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END) as totalPos,
sum( CASE WHEN (h_status='Positive') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbPos,
sum( CASE WHEN (h_status='Positive') and   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifPos, 
sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END) as totalNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifNeg,  
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') OR h_status='Declined' THEN 1 ELSE 0 END) as totalNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')   THEN 1 ELSE 0 END ) AS rifNA,
sum(CASE WHEN pat_type='sputum smear-positive relapse' THEN 1 ELSE 0 END) as totalsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum(CASE WHEN pat_type='sputum smear-negative relapse' THEN 1 ELSE 0 END) as totalsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum(CASE WHEN pat_type='Return after defaulting' THEN 1 ELSE 0 END) as totalReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum(CASE WHEN pat_type='Failure 1-st line treatment' THEN 1 ELSE 0 END) as totalFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN pat_type='Failure re-treatment' THEN 1 ELSE 0 END) as totalFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum(CASE WHEN pat_type='New Patients' THEN 1 ELSE 0 END) as totalNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum(CASE WHEN pat_type='New case PTB' THEN 1 ELSE 0 END) as totalNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum(CASE WHEN pat_type='MDR TB Contact' THEN 1 ELSE 0 END) as totalContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum(CASE WHEN pat_type='Refugees SS+ve' THEN 1 ELSE 0 END) as totalRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum(CASE WHEN pat_type='HCWs' THEN 1 ELSE 0 END) as totalHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum(CASE WHEN pat_type='Hiv(+) & Smear(-)' THEN 1 ELSE 0 END) as totalHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND MONTH(End_Time)='$currentmonth' AND YEAR(End_Time)='$currentyear'";

	  }
	  elseif ($filter==1)//last 6 months $fromdate$todate
	  {
	  $query_str="SELECT count(*) as total,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR  Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR  Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' THEN 1 ELSE 0 END ) AS mtb,
sum(CASE WHEN Test_Result = 'MTB NOT DETECTED'  THEN 1 ELSE 0 END) as neg,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' THEN 1 ELSE 0 END ) AS rif, 
 sum(CASE WHEN (age<5) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END) as totalbelow,

sum( CASE WHEN ( age<5 ) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbbelow,
sum( CASE WHEN  (age<5) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifbelow,
sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END) as totalbtwn,
sum( CASE WHEN  (age Between 6 AND 15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbbtwn,
sum( CASE WHEN (age Between 6 AND 15) AND   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifbtwn,
sum(CASE WHEN (age>15) THEN 1 ELSE 0 END) as totalabove,
sum( CASE WHEN (age>15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =    'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbabove,
sum( CASE WHEN  (age>15) AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifabove,
sum(CASE WHEN (gender='Male') THEN 1 ELSE 0 END) as totalMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED' ) THEN 1 ELSE 0 END ) AS mtbMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifMale,
sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END) as totalFemale,
sum( CASE WHEN (gender='Female') AND   (Test_Result =    'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFemale,
sum( CASE WHEN (gender='Female') AND    (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifFemale,
sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) as totalNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNotsp,  
sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END) as totalPos,
sum( CASE WHEN (h_status='Positive') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbPos,
sum( CASE WHEN (h_status='Positive') and   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifPos, 
sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END) as totalNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifNeg,  
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') OR h_status='Declined' THEN 1 ELSE 0 END) as totalNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')   THEN 1 ELSE 0 END ) AS rifNA,
sum(CASE WHEN pat_type='sputum smear-positive relapse' THEN 1 ELSE 0 END) as totalsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum(CASE WHEN pat_type='sputum smear-negative relapse' THEN 1 ELSE 0 END) as totalsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum(CASE WHEN pat_type='Return after defaulting' THEN 1 ELSE 0 END) as totalReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum(CASE WHEN pat_type='Failure 1-st line treatment' THEN 1 ELSE 0 END) as totalFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN pat_type='Failure re-treatment' THEN 1 ELSE 0 END) as totalFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum(CASE WHEN pat_type='New Patients' THEN 1 ELSE 0 END) as totalNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum(CASE WHEN pat_type='New case PTB' THEN 1 ELSE 0 END) as totalNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum(CASE WHEN pat_type='MDR TB Contact' THEN 1 ELSE 0 END) as totalContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum(CASE WHEN pat_type='Refugees SS+ve' THEN 1 ELSE 0 END) as totalRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum(CASE WHEN pat_type='HCWs' THEN 1 ELSE 0 END) as totalHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum(CASE WHEN pat_type='Hiv(+) & Smear(-)' THEN 1 ELSE 0 END) as totalHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromdate' AND '$todate'  AND cond='1' ";
	  }
	  elseif ($filter==2)//cusomtize dates $fromfiler $tofilter
	  {
	  	  $query_str="SELECT count(*) as total,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR  Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR  Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' THEN 1 ELSE 0 END ) AS mtb,
sum(CASE WHEN Test_Result = 'MTB NOT DETECTED'  THEN 1 ELSE 0 END) as neg,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' THEN 1 ELSE 0 END ) AS rif, 
 sum(CASE WHEN (age<5) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END) as totalbelow,

sum( CASE WHEN ( age<5 ) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbbelow,
sum( CASE WHEN  (age<5) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifbelow,
sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END) as totalbtwn,
sum( CASE WHEN  (age Between 6 AND 15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbbtwn,
sum( CASE WHEN (age Between 6 AND 15) AND   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifbtwn,
sum(CASE WHEN (age>15) THEN 1 ELSE 0 END) as totalabove,
sum( CASE WHEN (age>15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =    'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbabove,
sum( CASE WHEN  (age>15) AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifabove,
sum(CASE WHEN (gender='Male') THEN 1 ELSE 0 END) as totalMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED' ) THEN 1 ELSE 0 END ) AS mtbMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifMale,
sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END) as totalFemale,
sum( CASE WHEN (gender='Female') AND   (Test_Result =    'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFemale,
sum( CASE WHEN (gender='Female') AND    (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifFemale,
sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) as totalNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNotsp,  
sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END) as totalPos,
sum( CASE WHEN (h_status='Positive') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbPos,
sum( CASE WHEN (h_status='Positive') and   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifPos, 
sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END) as totalNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifNeg,  
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') OR h_status='Declined' THEN 1 ELSE 0 END) as totalNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')   THEN 1 ELSE 0 END ) AS rifNA,
sum(CASE WHEN pat_type='sputum smear-positive relapse' THEN 1 ELSE 0 END) as totalsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum(CASE WHEN pat_type='sputum smear-negative relapse' THEN 1 ELSE 0 END) as totalsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum(CASE WHEN pat_type='Return after defaulting' THEN 1 ELSE 0 END) as totalReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum(CASE WHEN pat_type='Failure 1-st line treatment' THEN 1 ELSE 0 END) as totalFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN pat_type='Failure re-treatment' THEN 1 ELSE 0 END) as totalFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum(CASE WHEN pat_type='New Patients' THEN 1 ELSE 0 END) as totalNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum(CASE WHEN pat_type='New case PTB' THEN 1 ELSE 0 END) as totalNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum(CASE WHEN pat_type='MDR TB Contact' THEN 1 ELSE 0 END) as totalContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum(CASE WHEN pat_type='Refugees SS+ve' THEN 1 ELSE 0 END) as totalRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum(CASE WHEN pat_type='HCWs' THEN 1 ELSE 0 END) as totalHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum(CASE WHEN pat_type='Hiv(+) & Smear(-)' THEN 1 ELSE 0 END) as totalHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromfilter' AND '$tofilter'  AND cond='1' ";
	  }
	    elseif ($filter==3)//month/year
	  {
	   $query_str="SELECT count(*) as total,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR  Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR  Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' THEN 1 ELSE 0 END ) AS mtb,
sum(CASE WHEN Test_Result = 'MTB NOT DETECTED'  THEN 1 ELSE 0 END) as neg,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' THEN 1 ELSE 0 END ) AS rif, 
 sum(CASE WHEN (age<5) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END) as totalbelow,

sum( CASE WHEN ( age<5 ) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbbelow,
sum( CASE WHEN  (age<5) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifbelow,
sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END) as totalbtwn,
sum( CASE WHEN  (age Between 6 AND 15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbbtwn,
sum( CASE WHEN (age Between 6 AND 15) AND   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifbtwn,
sum(CASE WHEN (age>15) THEN 1 ELSE 0 END) as totalabove,
sum( CASE WHEN (age>15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =    'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbabove,
sum( CASE WHEN  (age>15) AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifabove,
sum(CASE WHEN (gender='Male') THEN 1 ELSE 0 END) as totalMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED' ) THEN 1 ELSE 0 END ) AS mtbMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifMale,
sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END) as totalFemale,
sum( CASE WHEN (gender='Female') AND   (Test_Result =    'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFemale,
sum( CASE WHEN (gender='Female') AND    (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifFemale,
sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) as totalNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNotsp,  
sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END) as totalPos,
sum( CASE WHEN (h_status='Positive') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbPos,
sum( CASE WHEN (h_status='Positive') and   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifPos, 
sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END) as totalNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifNeg,  
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') OR h_status='Declined' THEN 1 ELSE 0 END) as totalNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')   THEN 1 ELSE 0 END ) AS rifNA,
sum(CASE WHEN pat_type='sputum smear-positive relapse' THEN 1 ELSE 0 END) as totalsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum(CASE WHEN pat_type='sputum smear-negative relapse' THEN 1 ELSE 0 END) as totalsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum(CASE WHEN pat_type='Return after defaulting' THEN 1 ELSE 0 END) as totalReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum(CASE WHEN pat_type='Failure 1-st line treatment' THEN 1 ELSE 0 END) as totalFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN pat_type='Failure re-treatment' THEN 1 ELSE 0 END) as totalFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum(CASE WHEN pat_type='New Patients' THEN 1 ELSE 0 END) as totalNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum(CASE WHEN pat_type='New case PTB' THEN 1 ELSE 0 END) as totalNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum(CASE WHEN pat_type='MDR TB Contact' THEN 1 ELSE 0 END) as totalContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum(CASE WHEN pat_type='Refugees SS+ve' THEN 1 ELSE 0 END) as totalRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum(CASE WHEN pat_type='HCWs' THEN 1 ELSE 0 END) as totalHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum(CASE WHEN pat_type='Hiv(+) & Smear(-)' THEN 1 ELSE 0 END) as totalHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND MONTH(End_Time)='$currentmonth' AND YEAR(End_Time)='$currentyear' AND cond='1'  ";
 	  }
	    elseif ($filter==4)//year only
	  {
	 $query_str="SELECT count(*) as total,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR  Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR  Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' THEN 1 ELSE 0 END ) AS mtb,
sum(CASE WHEN Test_Result = 'MTB NOT DETECTED'  THEN 1 ELSE 0 END) as neg,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' THEN 1 ELSE 0 END ) AS rif, 
 sum(CASE WHEN (age<5) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END) as totalbelow,

sum( CASE WHEN ( age<5 ) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbbelow,
sum( CASE WHEN  (age<5) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifbelow,
sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END) as totalbtwn,
sum( CASE WHEN  (age Between 6 AND 15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbbtwn,
sum( CASE WHEN (age Between 6 AND 15) AND   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifbtwn,
sum(CASE WHEN (age>15) THEN 1 ELSE 0 END) as totalabove,
sum( CASE WHEN (age>15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =    'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbabove,
sum( CASE WHEN  (age>15) AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifabove,
sum(CASE WHEN (gender='Male') THEN 1 ELSE 0 END) as totalMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED' ) THEN 1 ELSE 0 END ) AS mtbMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifMale,
sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END) as totalFemale,
sum( CASE WHEN (gender='Female') AND   (Test_Result =    'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFemale,
sum( CASE WHEN (gender='Female') AND    (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifFemale,
sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) as totalNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNotsp,  
sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END) as totalPos,
sum( CASE WHEN (h_status='Positive') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbPos,
sum( CASE WHEN (h_status='Positive') and   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifPos, 
sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END) as totalNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifNeg,  
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') OR h_status='Declined' THEN 1 ELSE 0 END) as totalNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')   THEN 1 ELSE 0 END ) AS rifNA,
sum(CASE WHEN pat_type='sputum smear-positive relapse' THEN 1 ELSE 0 END) as totalsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum(CASE WHEN pat_type='sputum smear-negative relapse' THEN 1 ELSE 0 END) as totalsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum(CASE WHEN pat_type='Return after defaulting' THEN 1 ELSE 0 END) as totalReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum(CASE WHEN pat_type='Failure 1-st line treatment' THEN 1 ELSE 0 END) as totalFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN pat_type='Failure re-treatment' THEN 1 ELSE 0 END) as totalFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum(CASE WHEN pat_type='New Patients' THEN 1 ELSE 0 END) as totalNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum(CASE WHEN pat_type='New case PTB' THEN 1 ELSE 0 END) as totalNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum(CASE WHEN pat_type='MDR TB Contact' THEN 1 ELSE 0 END) as totalContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum(CASE WHEN pat_type='Refugees SS+ve' THEN 1 ELSE 0 END) as totalRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum(CASE WHEN pat_type='HCWs' THEN 1 ELSE 0 END) as totalHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum(CASE WHEN pat_type='Hiv(+) & Smear(-)' THEN 1 ELSE 0 END) as totalHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND  YEAR(End_Time)='$currentyear'  AND cond='1' ";
	  }
	    elseif ($filter==7) //last 6 months $fromdate$todate
	  {
	  	  $query_str="SELECT count(*) as total,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR  Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR  Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' THEN 1 ELSE 0 END ) AS mtb,
sum(CASE WHEN Test_Result = 'MTB NOT DETECTED'  THEN 1 ELSE 0 END) as neg,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' THEN 1 ELSE 0 END ) AS rif, 
 sum(CASE WHEN (age<5) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END) as totalbelow,

sum( CASE WHEN ( age<5 ) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbbelow,
sum( CASE WHEN  (age<5) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifbelow,
sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END) as totalbtwn,
sum( CASE WHEN  (age Between 6 AND 15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbbtwn,
sum( CASE WHEN (age Between 6 AND 15) AND   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifbtwn,
sum(CASE WHEN (age>15) THEN 1 ELSE 0 END) as totalabove,
sum( CASE WHEN (age>15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =    'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbabove,
sum( CASE WHEN  (age>15) AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifabove,
sum(CASE WHEN (gender='Male') THEN 1 ELSE 0 END) as totalMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED' ) THEN 1 ELSE 0 END ) AS mtbMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifMale,
sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END) as totalFemale,
sum( CASE WHEN (gender='Female') AND   (Test_Result =    'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFemale,
sum( CASE WHEN (gender='Female') AND    (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifFemale,
sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) as totalNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNotsp,  
sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END) as totalPos,
sum( CASE WHEN (h_status='Positive') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbPos,
sum( CASE WHEN (h_status='Positive') and   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifPos, 
sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END) as totalNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifNeg,  
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') OR h_status='Declined' THEN 1 ELSE 0 END) as totalNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')   THEN 1 ELSE 0 END ) AS rifNA,
sum(CASE WHEN pat_type='sputum smear-positive relapse' THEN 1 ELSE 0 END) as totalsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum(CASE WHEN pat_type='sputum smear-negative relapse' THEN 1 ELSE 0 END) as totalsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum(CASE WHEN pat_type='Return after defaulting' THEN 1 ELSE 0 END) as totalReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum(CASE WHEN pat_type='Failure 1-st line treatment' THEN 1 ELSE 0 END) as totalFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN pat_type='Failure re-treatment' THEN 1 ELSE 0 END) as totalFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum(CASE WHEN pat_type='New Patients' THEN 1 ELSE 0 END) as totalNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum(CASE WHEN pat_type='New case PTB' THEN 1 ELSE 0 END) as totalNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum(CASE WHEN pat_type='MDR TB Contact' THEN 1 ELSE 0 END) as totalContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum(CASE WHEN pat_type='Refugees SS+ve' THEN 1 ELSE 0 END) as totalRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum(CASE WHEN pat_type='HCWs' THEN 1 ELSE 0 END) as totalHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum(CASE WHEN pat_type='Hiv(+) & Smear(-)' THEN 1 ELSE 0 END) as totalHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromdate' AND '$todate' AND cond='1'  ";
	  }
	       elseif ($filter==8) //all
	  {
	  	  $query_str="SELECT count(*) as total,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR  Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR  Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' THEN 1 ELSE 0 END ) AS mtb,
sum(CASE WHEN Test_Result = 'MTB NOT DETECTED'  THEN 1 ELSE 0 END) as neg,
sum( CASE WHEN Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR  Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' THEN 1 ELSE 0 END ) AS rif, 
sum(CASE WHEN (age<5) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END) as totalbelow,
sum( CASE WHEN ( age<5 ) AND ( Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' OR Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbbelow,
sum( CASE WHEN  (age<5) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED MEDIUM; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifbelow,
sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END) as totalbtwn,
sum( CASE WHEN  (age Between 6 AND 15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbbtwn,
sum( CASE WHEN (age Between 6 AND 15) AND   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifbtwn,
sum(CASE WHEN (age>15) THEN 1 ELSE 0 END) as totalabove,
sum( CASE WHEN (age>15) AND  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =    'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbabove,
sum( CASE WHEN  (age>15) AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =   'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =    'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifabove,
sum(CASE WHEN (gender='Male') THEN 1 ELSE 0 END) as totalMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =     'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =     'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED' ) THEN 1 ELSE 0 END ) AS mtbMale,
sum( CASE WHEN (gender='Male') AND  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =    'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =     'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE' ) THEN 1 ELSE 0 END ) AS rifMale,
sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END) as totalFemale,
sum( CASE WHEN (gender='Female') AND   (Test_Result =    'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFemale,
sum( CASE WHEN (gender='Female') AND    (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifFemale,
sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) as totalNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED'OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNotsp,
sum( CASE WHEN (gender='Not specified') AND   (Test_Result =   'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNotsp,  
sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END) as totalPos,
sum( CASE WHEN (h_status='Positive') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbPos,
sum( CASE WHEN (h_status='Positive') and   (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifPos, 
sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END) as totalNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNeg,
sum( CASE WHEN (h_status='Negative') and  (Test_Result = 'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifNeg,  
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') OR h_status='Declined' THEN 1 ELSE 0 END) as totalNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and (Test_Result =   'MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result =  'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED') THEN 1 ELSE 0 END ) AS mtbNA,
sum( CASE WHEN (h_status='Not Done' OR h_status='Declined') and  (Test_Result =  'MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result = 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result =  'MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')   THEN 1 ELSE 0 END ) AS rifNA,
sum(CASE WHEN pat_type='sputum smear-positive relapse' THEN 1 ELSE 0 END) as totalsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum(CASE WHEN pat_type='sputum smear-negative relapse' THEN 1 ELSE 0 END) as totalsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum(CASE WHEN pat_type='Return after defaulting' THEN 1 ELSE 0 END) as totalReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum(CASE WHEN pat_type='Failure 1-st line treatment' THEN 1 ELSE 0 END) as totalFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN pat_type='Failure re-treatment' THEN 1 ELSE 0 END) as totalFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum(CASE WHEN pat_type='New Patients' THEN 1 ELSE 0 END) as totalNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum(CASE WHEN pat_type='New case PTB' THEN 1 ELSE 0 END) as totalNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum(CASE WHEN pat_type='MDR TB Contact' THEN 1 ELSE 0 END) as totalContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum(CASE WHEN pat_type='Refugees SS+ve' THEN 1 ELSE 0 END) as totalRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum(CASE WHEN pat_type='HCWs' THEN 1 ELSE 0 END) as totalHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum(CASE WHEN pat_type='Hiv(+) & Smear(-)' THEN 1 ELSE 0 END) as totalHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND cond='1'  ";
	  }
	     
	  

			$result = $this->db->query($query_str)->result_array();

			$TTC = $result;

	  }

function totalTestsPerCountyByAge($countyID,$filter,$currentmonth,$currentyear,$fromfilter,$tofilter,$fromdate,$todate)
	  {
	  if ($filter==0) //last submission
	  {
	   $query_str="SELECT  sum(CASE WHEN age>15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 0 AND 5 THEN 1 ELSE 0 END)
              FROM sample
							LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
							LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
							LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
							LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
							WHERE `countys`.`ID` ='$countyID' AND MONTH(End_Time)='$currentmonth' AND YEAR(End_Time)='$currentyear' AND cond='1' ";

				  }
	  elseif ($filter==1)//last 6 months $fromdate$todate
	  {
	   $query_str="SELECT  sum(CASE WHEN age>15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 0 AND 5 THEN 1 ELSE 0 END)
              FROM sample
							LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
							LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
							LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
							LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
							WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromdate' AND '$todate'  AND cond='1' ";
								  }
	  elseif ($filter==2)//cusomtize dates $fromfiler $tofilter
	  {
	  	   $query_str="SELECT  sum(CASE WHEN age>15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 0 AND 5 THEN 1 ELSE 0 END)
              FROM sample
							LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
							LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
							LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
							LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
							WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromfilter' AND '$tofilter'  AND cond='1' ";
								  }
	    elseif ($filter==3)//month/year
	  {
	    $query_str="SELECT  sum(CASE WHEN age>15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 0 AND 5 THEN 1 ELSE 0 END)
              FROM sample
							LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
							LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
							LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
							LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
							WHERE `countys`.`ID` ='$countyID' AND MONTH(End_Time)='$currentmonth' AND YEAR(End_Time)='$currentyear' AND cond='1'  ";
		 	  }				
	    elseif ($filter==4)//year only
	  {
	  $query_str="SELECT  sum(CASE WHEN age>15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 0 AND 5 THEN 1 ELSE 0 END)
              FROM sample
							LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
							LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
							LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
							LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
							WHERE `countys`.`ID` ='$countyID' AND  YEAR(End_Time)='$currentyear'  AND cond='1' ";
								  }
	    elseif ($filter==7) //last 6 months $fromdate$todate
	  {
	  	   $query_str="SELECT  sum(CASE WHEN age>15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 0 AND 5 THEN 1 ELSE 0 END)
              FROM sample
							LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
							LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
							LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
							LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
							WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromdate' AND '$todate' AND cond='1'  ";
								  }
	     elseif ($filter==8) //all
	  {
	  	   $query_str="SELECT  sum(CASE WHEN age>15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 6 AND 15 THEN 1 ELSE 0 END),sum(CASE WHEN age Between 0 AND 5 THEN 1 ELSE 0 END)
              FROM sample
							LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
							LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
							LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
							LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
							WHERE `countys`.`ID` ='$countyID' AND cond='1'  ";
								  }
	     
	  
		

		$result = $this->db->query($query_str)->result_array();
		$ageC = $result;



	



	  }
	


 function totalTestsPerCountyByGender($countyID,$filter,$currentmonth,$currentyear,$fromfilter,$tofilter,$fromdate,$todate)
	  {
	  if ($filter==0) //last submission
	  {
	   $query_str="SELECT  sum(CASE WHEN gender='Male' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND MONTH(End_Time)='$currentmonth' AND YEAR(End_Time)='$currentyear'";

	  }
	  elseif ($filter==1)//last 6 months $fromdate$todate
	  {
	   $query_str="SELECT  sum(CASE WHEN gender='Male' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromdate' AND '$todate'  AND cond='1' ";
	  }
	  elseif ($filter==2)//cusomtize dates $fromfiler $tofilter
	  {
	  	   $query_str="SELECT  sum(CASE WHEN gender='Male' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromfilter' AND '$tofilter'  AND cond='1' ";
	  }
	    elseif ($filter==3)//month/year
	  {
	    $query_str="SELECT  sum(CASE WHEN gender='Male' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND MONTH(End_Time)='$currentmonth' AND YEAR(End_Time)='$currentyear' AND cond='1'  ";
 	  }
	    elseif ($filter==4)//year only
	  {
	  $query_str="SELECT  sum(CASE WHEN gender='Male' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND  YEAR(End_Time)='$currentyear'  AND cond='1' ";
	  }
	    elseif ($filter==7) //last 6 months $fromdate$todate
	  {
	  	   $query_str="SELECT  sum(CASE WHEN gender='Male' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromdate' AND '$todate' AND cond='1'  ";
	  }
	     elseif ($filter==8) //all
	  {
	  	   $query_str="SELECT  sum(CASE WHEN gender='Male' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Female' THEN 1 ELSE 0 END),sum(CASE WHEN gender='Not specified' THEN 1 ELSE 0 END) FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND cond='1'  ";
	  }
	 
		


	  	$result = $this->db->query($query_str)->result_array();
	  	$genderC = $result;



	  }


function totalTestsPerCountyByHStatus($countyID,$filter,$currentmonth,$currentyear,$fromfilter,$tofilter,$fromdate,$todate)
	  {
	  if ($filter==0) //last submission
	  {
	   $query_str="SELECT  sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Not Done' or h_status='Declined' THEN 1 ELSE 0 END)
 FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND MONTH(End_Time)='$currentmonth' AND YEAR(End_Time)='$currentyear'";

	  }
	  elseif ($filter==1)//last 6 months $fromdate$todate
	  {
	   $query_str="SELECT  sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Not Done' or h_status='Declined' THEN 1 ELSE 0 END)
 FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromdate' AND '$todate'  AND cond='1' ";
	  }
	  elseif ($filter==2)//cusomtize dates $fromfiler $tofilter
	  {
	  	   $query_str="SELECT  sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Not Done' or h_status='Declined' THEN 1 ELSE 0 END)
 FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromfilter' AND '$tofilter'  AND cond='1' ";
	  }
	    elseif ($filter==3)//month/year
	  {
	    $query_str="SELECT  sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Not Done' or h_status='Declined' THEN 1 ELSE 0 END)
 FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND MONTH(End_Time)='$currentmonth' AND YEAR(End_Time)='$currentyear' AND cond='1'  ";
 	  }
	    elseif ($filter==4)//year only
	  {
	  $query_str="SELECT  sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Not Done' or h_status='Declined' THEN 1 ELSE 0 END)
 FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND  YEAR(End_Time)='$currentyear'  AND cond='1' ";
	  }
	    elseif ($filter==7) //last 6 months $fromdate$todate
	  {
	  	   $query_str="SELECT  sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Not Done' or h_status='Declined' THEN 1 ELSE 0 END)
 FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromdate' AND '$todate' AND cond='1'  ";
	  }
	  elseif ($filter==8) //all
	  {
	  	   $query_str="SELECT  sum(CASE WHEN h_status='Positive' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Negative' THEN 1 ELSE 0 END),sum(CASE WHEN h_status='Not Done' or h_status='Declined' THEN 1 ELSE 0 END)
 FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND cond='1'  ";
	  }
	     
	 
		$return = $this->db->query($query_str)->result_array();
		$hstatusC = $return;


	  }


function totalTestsPerCountyByPtype($countyID,$filter,$currentmonth,$currentyear,$fromfilter,$tofilter,$fromdate,$todate)
	  {
	  if ($filter==0) //last submission
	  {
	  $query_str="SELECT sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND MONTH(End_Time)='$currentmonth' AND YEAR(End_Time)='$currentyear'";

	  }
	  elseif ($filter==1)//last 6 months $fromdate$todate
	  {
	   $query_str="SELECT sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromdate' AND '$todate'  AND cond='1' ";
	  }
	  elseif ($filter==2)//cusomtize dates $fromfiler $tofilter
	  {
	  	   $query_str="SELECT sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromfilter' AND '$tofilter'  AND cond='1' ";
	  }
	    elseif ($filter==3)//month/year
	  {
	    $query_str="SELECT sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND MONTH(End_Time)='$currentmonth' AND YEAR(End_Time)='$currentyear' AND cond='1'  ";
 	  }
	    elseif ($filter==4)//year only
	  {
	   $query_str="SELECT sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND  YEAR(End_Time)='$currentyear'  AND cond='1' ";
	  }
	    elseif ($filter==7) //last 6 months $fromdate$todate
	  {
	   $query_str="SELECT sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND End_Time BETWEEN '$fromdate' AND '$todate' AND cond='1'  ";
	  }
	  elseif ($filter==8) //all
	  {
	   $query_str="SELECT sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumpos,
sum( CASE WHEN  (pat_type='sputum smear-positive relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE')  THEN 1 ELSE 0 END ) AS rifsputumpos,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbsputumneg,
sum( CASE WHEN (pat_type='sputum smear-negative relapse') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifsputumneg,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbReturn,
sum( CASE WHEN (pat_type='Return after defaulting') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifReturn,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailure,
sum( CASE WHEN (pat_type='Failure 1-st line treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailure,  
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbFailureRt,
sum( CASE WHEN (pat_type='Failure re-treatment') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifFailureRt,  
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNP,
sum( CASE WHEN (pat_type='New Patients') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNP,  
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbNewcase,
sum( CASE WHEN (pat_type='New case PTB') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifNewcase,  
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbContact,
sum( CASE WHEN (pat_type='MDR TB Contact') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifContact,  
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbRef,
sum( CASE WHEN (pat_type='Refugees SS+ve') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifRef,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHCWs,
sum( CASE WHEN (pat_type='HCWs') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHCWs,  
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance NOT DETECTED' OR 'MTB DETECTED LOW; Rif Resistance NOT DETECTED' OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance NOT DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE'  OR Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR Test_Result ='MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED')  THEN 1 ELSE 0 END ) AS mtbHivSmear,
sum( CASE WHEN (pat_type='Hiv(+) & Smear(-)') AND (Test_Result ='MTB DETECTED HIGH; Rif Resistance DETECTED' OR 'MTB DETECTED LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED MEDIUM; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance DETECTED'  OR Test_Result ='MTB DETECTED VERY LOW; Rif Resistance INDETERMINATE') THEN 1 ELSE 0 END ) AS rifHivSmear  
FROM sample
LEFT  JOIN `facilitys` ON `sample`.`facility` = `facilitys`.`ID`
LEFT  JOIN `districts` ON `districts`.`ID` = `facilitys`.`district`
LEFT  JOIN `countys` ON `countys`.`ID` = `districts`.`county`
LEFT  JOIN `provinces` ON `countys`.`province` = `provinces`.`ID`
WHERE `countys`.`ID` ='$countyID' AND cond='1'  ";
	  }
	     
	
		$result = $this->db->query($query_str)->result_array();

		$ptypeC = $result;
	  }



public function TOTALFacilitypercounty($county){
					
			$query_str="SELECT 
			`facilitys`.`facilitycode` AS CODE,
			`facilitys`.`name` AS FACILITY, 
			`districts`.`name` AS DISTRICT,
			`countys`.`name` AS COUNTY
			FROM `facilitys` , `districts` ,`countys`
			WHERE 
			`districts`.`ID` = `facilitys`.`district`
			AND `countys`.`ID` = `districts`.`county`
			AND `countys`.`ID` = '$county'

			";
			

			$result = $this->db->query($query_str)->result_array();
			$TT1 = $result;
			return $TT1;
				
			}




			public function TOTALFacilityReportedpercounty($county,$previousmonth,$currentyear){
			$query_str= "SELECT 
			`consumption`.`facility` AS a,
			`facilitys`.`name` AS b, 
			`districts`.`name` AS c,
			consumption.commodity AS d,
			consumption.quantity AS e,
			consumption.quantity_used AS f,
			consumption.end_bal AS g,
			consumption.q_req AS h,
			`countys`.`name` as county
			FROM `consumption` ,facilitys, `districts` ,`countys`
			WHERE 
			`consumption`.`facility`= `facilitys`.`facilitycode`
			AND  `districts`.`ID` = `facilitys`.`district`
			AND `countys`.`ID` = `districts`.`county`
			AND `countys`.`ID` = '$county'
			AND MONTH(consumption.date)='$previousmonth'
			AND YEAR(consumption.date)='$currentyear'
			Group by `consumption`.`facility`";
			

			$result = $this->db->query($query_str)->result_array();
			$TT = $result;
			return $TT;

			}





//END

}






